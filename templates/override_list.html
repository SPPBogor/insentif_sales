{% extends "base.html" %}
{% block content %}
<div class="d-flex justify-content-between align-items-center mb-3">
  <h3>Daftar Insentif Call</h3>
  <div class="d-flex">
    <a href="{{ url_for('override_new') }}" class="btn btn-primary btn-sm">
      <i class="fas fa-plus"></i> Tambah
    </a>
  </div>
  </div>

  <div class="table-responsive">
    <table id="tabelover" class="table table-sm table-hover sortable">
        <thead class="thead">
          <tr class="text-center">
            <th>#</th>
            <th style="width:22%">Nama Sales</th>
            <th style="width:14%">Divisi</th>
            <th style="width:12%">Bulan</th>
            <th style="width:14%">Nominal (Rp)</th>
            <th style="width:10%">Aktif</th>
            <th style="width:18%">Aksi</th>
          </tr>
        </thead>
        <tbody>
          {% for r, s in rows %}
          <tr>
            <td></td>
            <td>{{ s.name }}</td>
            <td class="text-center">{{ s.divisi }}</td>
            <td class="text-center">{{ r.bulan or '—' }}</td>
            <td class="text-right">{{ "{:,.0f}".format(r.amount) }}</td>
            <td class="text-center">
              {% if r.is_active %}
                <span class="badge badge-success">Aktif</span>
              {% else %}
                <span class="badge badge-secondary">Nonaktif</span>
              {% endif %}
            </td>
            <td class="text-right">
            <a href="{{ url_for('override_edit', id=r.id) }}" class="btn btn-sm btn-outline-warning">Edit</a>
            <form action="{{ url_for('override_delete', id=r.id) }}" method="post"
                  style="display:inline" onsubmit="return confirm('Yakin ingin menghapus data ini?')">
              <button class="btn btn-sm btn-outline-danger">Hapus</button>
            </form>
          </td>
          </tr>
          {% else %}
          <tr><td colspan="8" class="text-center text-muted py-3">Belum ada override</td></tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

  <div class="mt-3">
    <a href="{{ url_for('insentif_list') }}" class="btn btn-light btn-sm">← Kembali ke Rate Umum</a>
  </div>
<link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css">
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
<script>
$(function () {
  // Jika sudah pernah diinit, ambil instance yg ada; kalau belum, baru init
  const t = $.fn.dataTable.isDataTable('#tabelover')
    ? $('#tabelover').DataTable()
    : $('#tabelover').DataTable({
        pageLength: 25,
        order: [[1,'asc']],
        columnDefs: [
          { orderable: false, targets: 0 },
          { className: 'text-right', targets: [4,5,6,7] }
        ],
        language: {
          search: "Cari:",
          lengthMenu: "Tampilkan _MENU_ data",
          info: "Menampilkan _START_–_END_ dari _TOTAL_ data",
          infoEmpty: "Tidak ada data",
          paginate: { previous: "«", next: "»" }
        }
      });

  function renumber(){
    // mulai dari 1 setiap halaman (hapus info.start jika mau continuous)
    const info = t.page.info();
    t.column(0, {search:'applied', order:'applied', page:'current'}).nodes()
     .each(function(cell,i){ cell.innerHTML = i + 1; });
  }
  t.on('order.dt search.dt draw.dt', renumber);
  renumber();
});
</script>
{% endblock %}
